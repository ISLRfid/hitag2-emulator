# HITAG 2 Technology Research

## 1. Overview
HITAG 2 is a proprietary RFID technology developed by NXP Semiconductors (formerly Philips). It operates at 125 kHz and is primarily used in automotive immobilizers, access control systems, and industrial identification. It features a 48-bit stream cipher for authentication and data encryption.

## 2. Physical Layer

### 2.1 RF Interface
- **Frequency**: 125 kHz (LF - Low Frequency).
- **Coupling**: Inductive coupling between the reader coil and the tag antenna.
- **Power**: Passive tags, powered by the magnetic field generated by the reader.

### 2.2 Reader to Tag Communication (Downlink)
- **Modulation**: 100% ASK (Amplitude Shift Keying). Some modes might support 10% ASK, but HITAG 2 typically uses Pulse Interval Encoding (PIE).
- **Encoding**: Pulse Interval Encoding.
- **Data Rate**: Variable, typically around 4 kbps.

### 2.3 Tag to Reader Communication (Uplink)
- **Modulation**: Load modulation using a subcarrier.
- **Encoding**: Manchester or Bi-Phase (BPL) encoding.
- **Data Rate**: Typically 2 kbps or 4 kbps depending on the mode.

### 2.4 Timing Parameters
- **Bit Period**: 250 µs to 500 µs (standard).
- **Subcarrier**: 62.5 kHz (half the carrier frequency).
- **Synchronization**: The tag synchronizes its internal clock to the carrier field.

## 3. Memory Organization
HITAG 2 tags have 256 bits of EEPROM memory, organized into 8 pages of 32 bits each.

| Page | Description | Access in Crypto Mode |
|------|-------------|----------------------|
| 0 | Serial Number (UID) | Read-only |
| 1 | Configuration / Password (low) | Protected |
| 2 | Secret Key (low) | Protected |
| 3 | Secret Key (high) / Password (high) | Protected |
| 4 | User Data | Read/Write (encrypted) |
| 5 | User Data | Read/Write (encrypted) |
| 6 | User Data | Read/Write (encrypted) |
| 7 | User Data | Read/Write (encrypted) |

- **UID (Page 0)**: Unique 32-bit identifier.
- **Configuration (Page 1)**: Defines the operating mode and access rights.
- **Secret Key (Pages 2 & 3)**: 48-bit secret key used for authentication.
- **Password**: 32-bit password used in Password Mode.

## 4. Operating Modes

### 4.1 Public Mode A/B
The tag cyclically transmits its UID and some memory contents as soon as it enters the field. No authentication is required.

### 4.2 Password Mode
Requires the reader to send a 32-bit password before memory can be accessed. Data is transmitted in the clear.

### 4.3 Crypto Mode
The most secure mode. Requires mutual authentication using a 48-bit secret key and a 32-bit challenge. All subsequent data exchange is encrypted using a stream cipher.

## 5. Protocol Flow (Crypto Mode)

1. **Activation**: Tag enters the 125 kHz field and powers up.
2. **Standard Mode Entry**: The tag starts in a state where it waits for a command.
3. **Authentication Start**:
   - Reader sends a `START_AUTH` command (typically 5 bits: `11000`).
   - Tag responds with its 32-bit UID.
4. **Challenge-Response**:
   - Reader sends a 32-bit random challenge ($n_R$).
   - Both Reader and Tag initialize their internal stream ciphers with the 48-bit Secret Key, the UID, and the challenge $n_R$.
   - Tag generates a 32-bit response ($a_T$) and sends it to the Reader.
   - Reader verifies $a_T$.
5. **Encrypted Communication**:
   - If authentication is successful, all further commands and data are encrypted.
   - Commands like `READ_PAGE` or `WRITE_PAGE` are sent as encrypted bitstreams.

## 6. HITAG 2 Stream Cipher

### 6.1 Architecture
The cipher consists of:
- **LFSR**: 48-bit Linear Feedback Shift Register.
- **Filter Function**: A non-linear function that takes 20 bits from the LFSR state and produces a 1-bit output ($keystream$).

### 6.2 LFSR Feedback
The feedback polynomial is: $x^{48} + x^{43} + x^{38} + x^{18} + x^{17} + x^{14} + x^{12} + x^7 + x^5 + 1$.

### 6.3 Filter Function (Non-linear)
The 20 bits from the LFSR are passed through three layers of Boolean functions ($f_a, f_b, f_c$):
- $L_1$: 4-bit to 1-bit functions.
- $L_2$: 3-bit to 1-bit functions.
- $L_3$: 5-bit to 1-bit function.

### 6.4 Security Status
HITAG 2 is considered cryptographically weak.
- **Key length**: 48 bits is susceptible to brute-force attacks with modern hardware.
- **Cipher Weaknesses**: Vulnerabilities in the filter function allow for algebraic attacks and correlation attacks.
- **Attacks**: Recovery of the 48-bit key is possible within minutes using a PC and a few captured authentication attempts.

## 7. Commands

| Command | Binary Code | Purpose |
|---------|-------------|---------|
| READ    | `110aa`     | Read page `aa` (after auth) |
| WRITE   | `100aa`     | Write page `aa` (after auth) |
| AUTH    | `11xxx`     | Initiate authentication |
| HALT    | `00xxx`     | Put tag into sleep mode |

## 8. Paxton NET2 Specific Implementation
Paxton NET2 uses HITAG 2 in Crypto Mode.
- It leverages the user data pages to store proprietary access control information.
- The security relies on the 48-bit key, which is often derived from the UID or a system-wide master key.
- Full emulation requires both the UID and the Secret Key.

## 9. Technology Trends
While HITAG 2 is still widely used in legacy systems, it is being replaced by more secure technologies like HITAG 3, MIFARE DESFire (13.56 MHz), and HID iCLASS due to the known vulnerabilities in its encryption.
